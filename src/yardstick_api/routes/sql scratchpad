select ass.id from student_assessment sa 
join assessment_instance ai on sa.assessment_instance_id = ai.id 
join assessment_term term on ai.assessment_term_id = term.id
join assessment ass on term.assessment_id = ass.id
where sa.student_id = 1 
  and ai.academic_year_id = 2021
group by ass.id;


select a.name, a.id, sa.yardstick_performance_rating from (
  select term.assessment_id, max(ordering) as ordering from student_assessment sa 
  join assessment_instance ai on sa.assessment_instance_id = ai.id 
  join assessment_term term on ai.assessment_term_id = term.id
  where sa.student_id = 1 
    and ai.academic_year_id > 2020
  group by term.assessment_id
) recent_term
join assessment_term term
on recent_term.assessment_id = term.assessment_id
  and recent_term.ordering = term.ordering
join assessment a on term.assessment_id = a.id
join assessment_instance ai 
on term.id = ai.assessment_term_id
  and ai.academic_year_id = 2021
join student_assessment sa on ai.id = sa.assessment_instance_id
  and sa.student_id = 1
;

SELECT assessment.name, assessment.name, student_assessment.yardstick_performance_rating 
FROM (
  SELECT assessment_term.assessment_id, max(assessment_term.ordering) AS ordering 
  FROM student_assessment 
  INNER JOIN assessment_instance 
  ON student_assessment.assessment_instance_id = assessment_instance.id
  INNER JOIN assessment_term 
  ON assessment_instance.assessment_term_id = assessment_term.id 
  WHERE (student_assessment.student_id = 1 AND assessment_instance.academic_year_id >= 2020) 
  GROUP BY assessment_term.assessment_id
) recent_term 
INNER JOIN assessment_term 
ON (recent_term.assessment_id = assessment_term.assessment_id 
  AND recent_term.ordering = assessment_term.ordering) 
INNER JOIN assessment 
ON assessment_term.assessment_id = assessment.id 
INNER JOIN assessment_instance 
ON (assessment_term.id = assessment_instance.assessment_term_id 
  AND assessment_instance.academic_year_id = 2021) 
INNER JOIN student_assessment 
ON (assessment_instance.id = student_assessment.assessment_instance_id 
  AND student_assessment.student_id = 1);